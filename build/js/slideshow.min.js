var bind=function(t,e){return function(){return t.apply(e,arguments)}};$(function(){var t,e,i,n,s,r,o,a,c,d,h,u,l,_;return n=$(window),i=$("html"),e=$(document),t=$("body"),("undefined"==typeof u||null===u)&&(u={}),("undefined"==typeof l||null===l)&&(l={}),o="id_modal_get_archives",r="event_open_modal",c=function(){function t(){var t;this._isPC=!0,t=window.navigator.userAgent.toLowerCase(),0<=t.indexOf("iphone")||0<=t.indexOf("ipad")||0<=t.indexOf("ipod")?this._isPC=!1:0<=t.indexOf("windows")&&0<=t.indexOf("phone")?this._isPC=!1:0<=t.indexOf("android")&&0<=t.indexOf("mobile")?this._isPC=!1:0<=t.indexOf("firefox")&&0<=t.indexOf("mobile")?this._isPC=!1:0<=t.indexOf("blackberry")&&(this._isPC=!1),this._archives=[]}return t.prototype.getIsPc=function(){return Boolean(this._isPC)},t.prototype.setArchives=function(t){return this._archives=t},t.prototype.getArchives=function(){return this._archives},t.prototype.getArchiveById=function(t){var e,i,n,s;if(!t)return null;for(s=this._archives,i=0,n=s.length;n>i;i++)if(e=s[i],e.id===t)return e;return null},t}(),s=function(){function t(t){this._completeSlide=bind(this._completeSlide,this),this._startSlide=bind(this._startSlide,this),this._$target=t.$target,this._$items=$("#js-archivesItems"),this._$carousel=$("#js-archivesCarousel"),this._$item=this._$target.find(".js-archivesItem").clone(),this._$data=this._$target.find("#js-archivesData"),this._$msg=this._$target.find("#js-archivesMsg"),this._$name=this._$target.find("#js-archivesName"),this._archives=_.getArchives(),this._$items.empty(),this._setItem(),this._$carousel.carousel(),this._$carousel.on("slide.bs.carousel",this._startSlide),this._$carousel.on("slid.bs.carousel",this._completeSlide)}return t.prototype._startSlide=function(t){return this._$data.velocity({opacity:[0,1]},{duration:200,easing:"linear"})},t.prototype._completeSlide=function(t){var e,i;return e=$(t.relatedTarget),i=_.getArchiveById(e.attr("id")),this._$name.html(decodeURIComponent(i.name)),this._$msg.html(decodeURIComponent(i.message)),this._$data.velocity({opacity:[1,0]},{duration:500,easing:"linear"})},t.prototype._setItem=function(){var t,e,i,n,s,r,o,a;for(o=this._archives,a=[],i=s=0,r=o.length;r>s;i=++s)e=o[i],t=this._$item.clone(),n=new u.Item({$target:t,id:e.id}),this._$items.append(t),0===i&&(t.addClass("active"),e=_.getArchiveById(e.id),this._$name.html(decodeURIComponent(e.name)),this._$msg.html(decodeURIComponent(e.message))),a.push(n.open());return a},t}(),u.Item=function(){function t(t){this._$target=t.$target,this._id=t.id,this._$img=this._$target.find(".js-archivesItemImg"),this._data=null,this._$target.attr("id",this._id)}return t.prototype.open=function(){return this._data=_.getArchiveById(this._id),this._$target.velocity({opacity:[1,0]},{duration:500,easing:"linear",complete:function(t){return function(){return t._$img.attr("src","./data/"+t._data.image),t._$img.css({opacity:0}),t._$img.on("load",function(){return t._$img.velocity({opacity:[1,0]},{duration:500,easing:"linear"})})}}(this)})},t}(),a=function(){function t(t){this._$target=t.$target,this._getArchives=new l.GetArchives({$target:$("#js-modalGetArchives")})}return t.prototype.open=function(t){return t.id===o?this._getArchives.open({success:t.data.success}):void 0},t}(),l.GetArchives=function(){function t(t){this._onClosed=bind(this._onClosed,this),this._onOpened=bind(this._onOpened,this),this._$target=t.$target,this._$connect=$("#js-modalGetArchivesConnect"),this._$failure=$("#js-modalGetArchivesFailure"),this._$msg=$("#js-modalGetArchivesMsg"),this._success=null,this._data=null,this._$target.on("shown.bs.modal",this._onOpened),this._$target.on("hidden.bs.modal",this._onClosed)}return t.prototype.open=function(t){return this._success=t.success,this._toggleView({id:"connect"}),this._$target.modal({backdrop:"static",keyboard:!1})},t.prototype._onOpened=function(){return $.ajax({url:"api/getArchives.php",type:"POST",dataType:"json",cache:!1,timeout:1e4}).done(function(t){return function(e){return 0===e.code?(t._data=e.data,t._$target.modal("hide")):(t._$msg.html(e.msg),t._toggleView({id:"failure"}))}}(this)).fail(function(t){return function(){return t._$msg.html("データの取得に失敗しました"),t._toggleView({id:"failure"})}}(this))},t.prototype._onClosed=function(){return this._success?this._success({data:this._data}):void 0},t.prototype._toggleView=function(t){return"connect"===t.id?(this._$connect.css({display:"block"}),this._$failure.css({display:"none"})):"failure"===t.id?(this._$connect.css({display:"none"}),this._$failure.velocity({opacity:[1,0],translateY:[0,-50]},{duration:500,easing:"easeOutSine",display:"block"})):void 0},t}(),t.on(r,function(t,e){return h.open({id:e.id,data:e.data||null})}),_=new c,h=new a({$target:$("#js-modal")}),d=null,t.trigger(r,[{id:o,data:{success:function(e){return function(e){var i,n;return _.setArchives(e.data),n=location.hash,n&&(n=String(n).replace("#",""),i=_.getArchiveById(n),i&&t.trigger(r,[{id:ID_MODAL_DETAIL,data:{id:i.id}}],!1)),d=new s({$target:$("#js-archives")})}}(this)}}],!1)});