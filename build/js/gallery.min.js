var bind=function(t,e){return function(){return t.apply(e,arguments)}};$(function(){var t,e,i,n,s,o,a,r,c,l,d,h,u,_,p,m,g;return n=$(window),i=$("html"),e=$(document),t=$("body"),("undefined"==typeof p||null===p)&&(p={}),("undefined"==typeof m||null===m)&&(m={}),c="id_modal_get_archives",r="id_modal_detail",a="id_modal_delete",l=8,o="event_open_modal",h=function(){function t(){var t;this._isPC=!0,t=window.navigator.userAgent.toLowerCase(),0<=t.indexOf("iphone")||0<=t.indexOf("ipad")||0<=t.indexOf("ipod")?this._isPC=!1:0<=t.indexOf("windows")&&0<=t.indexOf("phone")?this._isPC=!1:0<=t.indexOf("android")&&0<=t.indexOf("mobile")?this._isPC=!1:0<=t.indexOf("firefox")&&0<=t.indexOf("mobile")?this._isPC=!1:0<=t.indexOf("blackberry")&&(this._isPC=!1),this._archives=[]}return t.prototype.getIsPc=function(){return Boolean(this._isPC)},t.prototype.setArchives=function(t){return this._archives=t},t.prototype.getArchives=function(){return this._archives},t.prototype.getArchiveById=function(t){var e,i,n,s;if(!t)return null;for(s=this._archives,i=0,n=s.length;n>i;i++)if(e=s[i],e.id===t)return e;return null},t}(),s=function(){function t(t){this._onClickLoad=bind(this._onClickLoad,this),this._$target=t.$target,this._$items=$("#js-archivesItems"),this._$nav=$("#js-archivesNav"),this._$btnLoad=$("#js-archivesBtnLoad"),this._$item=this._$target.find(".js-archivesItem").clone(),this._archives=g.getArchives(),this._isComplete=!1,this._intervalId=null,this._loadedItemCount=0,this._$items.empty(),this._setItem(),this._$btnLoad.on("click",this._onClickLoad)}return t.prototype._onClickLoad=function(){return this._setItem()},t.prototype._setItem=function(){var t,e,i,n,s,o,a,r,c,d,h;for(s=[],d=this._archives,i=o=0,r=d.length;r>o;i=++o)e=d[i],this._loadedItemCount<=i&&i<this._loadedItemCount+l&&(t=this._$item.clone(),n=new p.Item({$target:t,id:e.id}),s.push(n),this._$items.append(t));if(1<=s.length){for(this._loadedItemCount+=l,h=0,i=a=0,c=s.length;c>a;i=++a)n=s[i],n.open({delay:100*i}),h+=100;return this._loadedItemCount<=this._archives.length?(this._intervalId&&clearTimeout,this._intervalId=setTimeout(function(t){return function(){return t._$nav.css({display:"block"})}}(this),h+1e3)):this._$nav.css({display:"none"})}},t}(),p.Item=function(){function e(t){this._onClickDetail=bind(this._onClickDetail,this),this._$target=t.$target,this._id=t.id,this._$thumb=this._$target.find(".js-archivesItemThumb"),this._$img=this._$target.find(".js-archivesItemImg"),this._$name=this._$target.find(".js-archivesItemName"),this._$btnDetail=this._$target.find(".js-archivesItemBtnDetail"),this._data=null,this._$target.attr("id",this._id)}return e.prototype.open=function(t){return this._data=g.getArchiveById(this._id),this._$name.text(decodeURIComponent(this._data.name)),this._$target.css({display:"block"}),this._$thumb.css({visibility:"hidden"}),this._$thumb.velocity({opacity:[1,0],translateY:[0,100],translateZ:[0,100],rotateZ:[0,10],rotateY:[0,45]},{duration:1200,easing:"easeOutQuint",delay:t.delay,begin:function(t){return function(){return t._$thumb.css({visibility:"visible"})}}(this),complete:function(t){return function(){return t._$img.attr("src","./data/"+t._data.image),t._$img.css({opacity:0}),t._$img.on("load",function(){return t._$img.velocity({opacity:[1,0]},{duration:500,easing:"linear"})}),t._$img.on("click",t._onClickDetail),t._$btnDetail.on("click",t._onClickDetail)}}(this)})},e.prototype._onClickDetail=function(e){return e.preventDefault(),t.trigger(o,[{id:r,data:{id:this._id}}],!1)},e}(),d=function(){function t(t){this._$target=t.$target,this._getArchives=new m.GetArchives({$target:$("#js-modalGetArchives")}),this._detail=new m.Detail({$target:$("#js-modalDetail")}),this._delete=new m.Delete({$target:$("#js-modalDelete")})}return t.prototype.open=function(t){return t.id===c?this._getArchives.open({success:t.data.success}):t.id===r?this._detail.open({id:t.data.id}):t.id===a?this._delete.open({id:t.data.id,success:t.data.success}):void 0},t}(),m.GetArchives=function(){function t(t){this._onClosed=bind(this._onClosed,this),this._onOpened=bind(this._onOpened,this),this._$target=t.$target,this._$connect=$("#js-modalGetArchivesConnect"),this._$failure=$("#js-modalGetArchivesFailure"),this._$msg=$("#js-modalGetArchivesMsg"),this._success=null,this._data=null,this._$target.on("shown.bs.modal",this._onOpened),this._$target.on("hidden.bs.modal",this._onClosed)}return t.prototype.open=function(t){return this._success=t.success,this._toggleView({id:"connect"}),this._$target.modal({backdrop:"static",keyboard:!1})},t.prototype._onOpened=function(){return $.ajax({url:"api/getArchives.php",type:"POST",dataType:"json",cache:!1,timeout:1e4}).done(function(t){return function(e){return 0===e.code?(t._data=e.data,t._$target.modal("hide")):(t._$msg.html(e.msg),t._toggleView({id:"failure"}))}}(this)).fail(function(t){return function(){return t._$msg.html("データの取得に失敗しました"),t._toggleView({id:"failure"})}}(this))},t.prototype._onClosed=function(){return this._success?this._success({data:this._data}):void 0},t.prototype._toggleView=function(t){return"connect"===t.id?(this._$connect.css({display:"block"}),this._$failure.css({display:"none"})):"failure"===t.id?(this._$connect.css({display:"none"}),this._$failure.velocity({opacity:[1,0],translateY:[0,-50]},{duration:500,easing:"easeOutSine",display:"block"})):void 0},t}(),m.Detail=function(){function e(t){this._onClickTw=bind(this._onClickTw,this),this._onClickDelete=bind(this._onClickDelete,this),this._$target=t.$target,this._$img=$("#js-modalDetailImg"),this._$name=$("#js-modalDetailName"),this._$msg=$("#js-modalDetailMsg"),this._$date=$("#js-modalDetailDate"),this._$btnTw=this._$target.find("#js-modalDetailBtnTw"),this._$btnDelete=this._$target.find("#js-modalDetailBtnDelete"),this._id=null,this._$btnTw.on("click",this._onClickTw),this._$btnDelete.on("click",this._onClickDelete)}return e.prototype.open=function(t){var e;if(t.id&&(this._id=t.id,e=g.getArchiveById(this._id)))return this._$img.attr("src","./data/"+e.image),this._$name.html(decodeURIComponent(e.name)),this._$msg.html(decodeURIComponent(e.message)),this._$date.html(e.date),this._$target.modal("show")},e.prototype._onClickDelete=function(e){return e.preventDefault(),this._$target.modal("hide"),t.trigger(o,[{id:a,data:{id:this._id}}])},e.prototype._onClickTw=function(t){var e,i,n,s,o,a;return t.preventDefault(),e=g.getArchiveById(this._id),i="https://twitter.com/intent/tweet",s=decodeURIComponent(e.name),s="【"+s+"】",s=encodeURIComponent(s),n=decodeURIComponent(e.message),n=n.replace("<br>",""),50<n.length&&(n=n.substr(0,50)+"..."),n=encodeURIComponent(n),a=String(location.href).split("#")[0]+"#"+this._id,a=encodeURIComponent(a),o=i+"?text="+s+n+"&url="+a,window.open(o,"tweet_window","width=640, height=300, menubar=no, toolbar=no, scrollbars=no, resizable=yes")},e}(),m.Delete=function(){function t(t){this._onClickDelete=bind(this._onClickDelete,this),this._$target=t.$target,this._$confirmation=$("#js-modalDeleteConfirmation"),this._$connect=$("#js-modalDeleteConnect"),this._$failure=$("#js-modalDeleteFailure"),this._$success=$("#js-modalDeleteSuccess"),this._$btnDelete=$("#js-modalDeleteBtnDelete"),this._$msg=$("#js-modalDeleteMsg"),this._$inputPw=$("#js-modalDeleteInputPw"),this._$btnDelete.on("click",this._onClickDelete),this._$target.on("hidden.bs.modal",this._onClosed)}return t.prototype.open=function(t){return this._id=t.id,this._toggleView({id:"confirmation"}),this._$target.modal({backdrop:"static",keyboard:!1})},t.prototype._onClickDelete=function(t){return t.preventDefault(),this._toggleView({id:"connect",complete:function(t){return function(){return $.ajax({url:"api/delete.php",type:"POST",dataType:"json",data:{pw:t._$inputPw.val()||"0000",id:t._id},cache:!1,timeout:1e4}).done(function(e){return 0===e.code?t._toggleView({id:"success"}):(t._$msg.html(e.msg),t._toggleView({id:"failure"}))}).fail(function(){return t._$msg.html("データの削除に失敗しました"),t._toggleView({id:"failure"})})}}(this)})},t.prototype._toggleView=function(t){var e;return e=t.complete||null,"confirmation"===t.id?(this._$confirmation.css({display:"block"}),this._$connect.css({display:"none"}),this._$failure.css({display:"none"}),this._$success.css({display:"none"})):"connect"===t.id?(this._$confirmation.css({display:"none"}),this._$connect.velocity({opacity:[1,0],translateY:[0,-50]},{duration:500,easing:"easeOutSine",display:"block",complete:function(t){return function(){return e?e():void 0}}(this)}),this._$failure.css({display:"none"}),this._$success.css({display:"none"})):"failure"===t.id?(this._$confirmation.css({display:"none"}),this._$connect.css({display:"none"}),this._$failure.velocity({opacity:[1,0],translateY:[0,-50]},{duration:500,easing:"easeOutSine",display:"block",complete:function(t){return function(){return e?e():void 0}}(this)}),this._$success.css({display:"none"})):"success"===t.id?(this._$confirmation.css({display:"none"}),this._$connect.css({display:"none"}),this._$failure.css({display:"none"}),this._$success.velocity({opacity:[1,0],translateY:[0,-50]},{duration:500,easing:"easeOutSine",display:"block",complete:function(t){return function(){return e?e():void 0}}(this)})):void 0},t}(),t.on(o,function(t,e){return _.open({id:e.id,data:e.data||null})}),g=new h,_=new d({$target:$("#js-modal")}),u=null,t.trigger(o,[{id:c,data:{success:function(e){return function(e){var i,n;return g.setArchives(e.data),n=location.hash,n&&(n=String(n).replace("#",""),i=g.getArchiveById(n),i&&t.trigger(o,[{id:r,data:{id:i.id}}],!1)),u=new s({$target:$("#js-archives")})}}(this)}}],!1)});